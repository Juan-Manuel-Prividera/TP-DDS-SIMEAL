{{> templates/header}}

<div class="d-flex vh-100">
    <!-- Sección de Encargos -->
    <div class="col-md-6 overflow-auto border-end p-3">
        <h2 class="mb-4">Encargos Asignados</h2>
        <ul class="list-group">
            {{#each encargos}}
                <li class="list-group-item mb-3">
                    <!-- Encargo principal -->
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>{{this.nombreHeladera}}</strong><br>
                            <small>{{this.fechaHora}}</small>
                        </div>
                        <div>
                            <button class="btn btn-success btn-sm" onclick="aceptarEncargo('{{this.id}}')">Aceptar</button>
                            <button class="btn btn-danger btn-sm ms-2" onclick="rechazarEncargo('{{this.id}}')">Rechazar</button>
                            <button class="btn btn-primary btn-sm ms-2" onclick="registrarVisita('{{this.id}}')">Registrar Visita</button>
                        </div>
                    </div>

                    <!-- Información detallada desplegable -->
                    <div id="detalles-encargo-{{@index}}" class="mt-2" style="display: none;">
                        <p><strong>Ubicación:</strong> {{this.ubicacionHeladera}}</p>
                        <p><strong>Descripción del Incidente:</strong> {{this.descripcionIncidente}}</p>
                    </div>
                </li>
            {{/each}}
        </ul>
    </div>

    <!-- Sección de Visitas Técnicas -->
    <div class="col-md-6 overflow-auto p-3">
        <h2 class="mb-4">Visitas Técnicas</h2>
        <ul class="list-group">
            {{#each visitas}}
                <li class="list-group-item mb-3">
                    <div>
                        <strong>{{this.nombreHeladera}}</strong><br>
                        <small>{{this.fechaHora}}</small><br>
                        <p><strong>Exitosa:</strong> {{#if this.exitosa}}Sí{{else}}No{{/if}}</p>
<!--                        {{#if this.imagen}}-->
<!--                            <img src="{{this.imagen}}" alt="Imagen de visita" class="img-fluid mt-2" style="max-width: 200px;">-->
<!--                        {{/if}}-->
                        <!-- Descripción desplegable -->
                        <div id="descripcion-{{@index}}" class="mt-2" style="display: none;">
                            <p>{{this.descripcion}}</p>
                        </div>
                    </div>
                </li>
            {{/each}}
        </ul>
    </div>
</div>

<script>
    function toggleDescripcion(index) {
        const descripcionElement = document.getElementById(`descripcion-${index}`);
        descripcionElement.style.display = descripcionElement.style.display === 'none' ? 'block' : 'none';
    }

    // Muestra u oculta la información detallada de cada encargo
    function toggleDetalles(index) {
        const detalles = document.getElementById(`detalles-encargo-${index}`);
        detalles.style.display = detalles.style.display === 'none' ? 'block' : 'none';
    }

    // Funciones de botón (ejemplo de cómo podrías manejarlos)
    function aceptarEncargo(index) {
        console.log('Encargo aceptado:', index);
        window.location.href = "/encargo/"+ index + "/aceptado"
    }

    function rechazarEncargo(index) {
        console.log('Encargo rechazado:', index);
        window.location.href = "/encargo/"+ index + "/rechazado"
    }

    function registrarVisita(index) {
        console.log('Visita registrada para encargo:', index);
        window.location.href = "/"+ index + "/visita"
    }

    // Agregar un evento para alternar el despliegue al hacer clic en el nombre del encargo
    document.querySelectorAll('li > div:first-child').forEach((element, index) => {
        element.addEventListener('click', () => toggleDetalles(index));
    });
</script>
